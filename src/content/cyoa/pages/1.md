<!-- Prolog -->

# Die Stadt der Diebe (Auszug)

*von Ian Livingstone*

*Dieses Abenteuer ist ein Auszug aus dem Buch "Die Stadt der Diebe" von Ian Livingstone und behandelt nur die Szene auf dem Piratenschiff. Bevor es losgeht, m√ºssen wir noch deine Werte f√ºr die Eigenschaften Gewandtheit, St√§rke und Gl√ºck bestimmen.*

<script>
    // gibt Ergebnis eines W√ºrfelwurfs mit einem W6 zur√ºck (1 bis 6)
    w6 = function() {
        return Math.trunc(Math.random() * 6) + 1;
    }

    // "Versuche dein Gl√ºck!"
    // - setzt Variable erfolg auf true, wenn Spieler Gl√ºck hat,
    //   ansonsten auf false und verringert die Gl√ºckspunkte um 1
    // - gibt Nachricht aus
    versuche_glueck = function() {
        erfolg = w6() + w6() <= glueck;
        increase_glueck(-1);
        print("> *Du versuchst dein Gl√ºck und verlierst dadurch einen Gl√ºckspunkt.*");
    }

    increase_glueck = function(points) {
        glueck = glueck + points;
        if (glueck > glueck_start) {
            glueck = glueck_start;
        }
        if (glueck < 0) {
            glueck = 0;
        }
    }

    increase_staerke = function(points) {
        staerke = staerke + points;
        if (staerke > staerke_start) {
            staerke = staerke_start;
        }
        if (staerke < 0) {
            staerke = 0;
        }
        if (staerke == 0) {
            // TODO: Spiel beenden
            print("<p>Du bist besiegt!</p>");
        }
    }

    kampf = async function(options = {}) {
        options.opponents ??= [];
        for (let opponent of options.opponents) {
            let gegner_name = opponent[0];
            let gegner_staerke = opponent[1];
            let gegner_gewandtheit = opponent[2];
            while (staerke > 0 && gegner_staerke > 0) {
                print(`Deine Lebenspunkte ${staerke} / Lebenspunkte ${gegner_name}: ${gegner_staerke}`);
                let kampfkraft_gegner = w6() + w6() + gegner_gewandtheit;
                let kampfkraft_spieler = w6() + w6() + gewandtheit;
                if (options.hooks?.adjustPowerSelf)
                    kampfkraft_spieler = options.hooks.adjustPowerSelf(kampfkraft_spieler);
                if (options.hooks?.adjustPowerOpponent)
                    kampfkraft_gegner = options.hooks.adjustPowerOpponent(kampfkraft_gegner);
                print(`Du hast deinem Gegner 2 Punkte Schaden zugef√ºgt.`);
                print(`M√∂chtest du dein Gl√ºck versuchen, um deinen Schaden zu erh√∂hen?`);
                let choice = await presentChoice([
                    ['y', "<span style='margin: 0 0.1em;'>üçÄ</span> Gl√ºck versuchen"],
                    ['n', "<span style='margin: 0 0.1em;'>‚öîÔ∏è</span> Weiterk√§mpfen"],
                ]);
                if (choice === 'y') {
                    versuche_glueck();
                    gegner_staerke -= 2;
                    print(`Du hattest Gl√ºck und hast deinem Gegner weitere Punkte Schaden zugef√ºgt.`);
                } else {
                }
                if (kampfkraft_spieler > kampfkraft_gegner) {
                    gegner_staerke -= 2;
                } else if (kampfkraft_spieler < kampfkraft_gegner) {
                    staerke -= 2;
                    print(`Dein Gegner hat dir Schaden zugef√ºgt.`);
                } else {
                    print("Ihr konntet eure gegenseitigen Angriffe abblocken.");
                }
            }
            if (gegner_staerke <= 0) {
                print(`Du hast ${gegner_name} besiegt!`);
                if (options.pageAfterWin) {
                    await forceTurnToPage(options.pageAfterWin);
                }
            }
            if (staerke <= 0) {
                print(`Du bist besiegt worden.`);
            }
        }
        print();
    }
</script>

- [Los geht's!](1a)