<div class="container">
  <div class="col-md-12">
    <h2>Automatron</h2>

    <!-- Examples -->
    <div class="mb-3">
      <h5 class="mb-2">Examples</h5>
      <div class="row" id="examples_list"></div>
    </div>

    <!-- Input -->
    <div class="input-group mb-3">
      <input class="form-control" type="text" id="ti_input" placeholder="Enter regex...">
      <button class="btn btn-primary" id="btn_process">Send</button>
    </div>

    <div id="output_area" class="mb-3"></div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {

    const exampleGroups = {
  "Easy": [
    { regex: 'a*',                desc: 'Zero or more a' },
    { regex: 'ab',                desc: 'Concatenation' },
    { regex: 'a|b',               desc: 'Alternation' },
    { regex: 'a+',                desc: 'One or more a' },
    { regex: 'a?b+',              desc: 'Optional a, then ≥1 b' }
  ],
  "Slightly richer": [
    { regex: '(a|b)*c',           desc: 'All words ending with c' },
    { regex: '(a|b)*a',           desc: 'All words ending with a' },
    { regex: 'a(b|c)',            desc: 'a followed by b or c' },
    { regex: '(a|b)(a|b)',        desc: 'All words of length 2 over {a,b}' },
    { regex: '(a|b)*(ab|ba)',     desc: 'Ends with ab or ba' }
  ],
  "Moderate": [
    { regex: '(ab)*',             desc: 'Even repetitions of "ab"' },
    { regex: 'a*b*',              desc: 'a’s then b’s (one block of b)' },
    { regex: 'a*b*a*',            desc: 'All b’s in a single block' },
    { regex: '(a|b)*aa',          desc: 'Ends with aa' },
    { regex: '(aa|bb)*',          desc: 'Even length, pairs of equal letters' }
  ],
  "Challenging": [
    { regex: '(a|b)*abb',         desc: 'Ends with abb' },
    { regex: '(a|b)*aba(a|b)*',   desc: 'Contains substring "aba"' },
    { regex: '(a|b)*a(a|b)*b(a|b)*', desc: 'Contains substring "ab"' },
    { regex: '(a|b)*b(a|b)*a(a|b)*', desc: 'Contains substring "ba"' },
    { regex: '(ab|ba)*',          desc: 'Even length alternating pairs' }
  ],
  "Binary (0/1)": [
    { regex: '(0|1)*1(0|1)(0|1)', desc: '3rd-last is 1' },
    { regex: '(0|1)*01(0|1)*',    desc: 'Contains 01' },
    { regex: '(0|1)*(00|11)(0|1)*', desc: 'Contains 00 or 11' },
  ],
  "Motivated": [
    { regex: '(a|b)*a(a|b)*a(a|b)*',   desc: 'At least two a’s' },
    { regex: '(a|b)*a(a|b)*a(a|b)*a(a|b)*', desc: 'At least three a’s' },
    { regex: '(a|b)*a(a|b)(a|b)',      desc: '3rd-last is a' }
  ]
};

  const $list = $('#examples_list');
  Object.entries(exampleGroups).forEach(([group, items], idx) => {
    const $col = $('<div class="col-md-6 mb-3"></div>');
    $col.append(`<h6 class="mt-3">${group}</h6>`);
    const $grp = $('<div class="list-group"></div>');
    items.forEach(ex => {
      const $item = $(`
        <button type="button" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
          <span><code>${ex.regex}</code> — ${ex.desc}</span>
          <span class="badge bg-secondary">Run</span>
        </button>
      `);
      $item.on('click', () => {
        $('#ti_input').val(ex.regex);
        processRegex(ex.regex);
        $list.find('.active').removeClass('active');
        $item.addClass('active');
      });
      $grp.append($item);
    });
    $col.append($grp);
    $list.append($col);
  });

  $('#ti_input').focus();
  $('#ti_input').on('keypress', function(e) {
    if (e.which == 13) $('#btn_process').click();
  });
  $('#btn_process').on('click', function() {
    const input = $('#ti_input').val();
    processRegex(input);
  });

  function processRegex(input) {
    if (!input || !input.trim()) return;
    const $btn = $('#btn_process');
    // $btn.prop('disabled', true).text('Working…');

    api_call('/api/automatron', { regex: input }, function(data) {
      console.log(data);
      const $out = $('#output_area');
      $out.empty();

      $out.append($('<h3>').html('&epsilon;-NFA'));
      $out.append($(data.nfa.svg));

      $out.append($('<h3>').text('DFA'));
      $out.append($(data.notes_subset_html));
      $out.append($(data.dfa.implicit_sink.svg));

      $out.append($('<h3>').text('DFA (minimized)'));
      $out.append($(data.notes_minimization_html));
      $out.append($(data.min_dfa.implicit_sink.svg));

      $out.append($('<h3>').text('Regular Grammar'));
      $out.append($('<pre>').text(data.grammar));

      $out.append($('<h3>').text('Samples (positive)'));
      $out.append($(data.samples_positive.map(x => `<i class='bi bi-check text-success mr-2'></i><code>${x}</code>`).join('<br>')));

      $out.append($('<h3>').text('Samples (negative)'));
      $out.append($(data.samples_negative.map(x => `<i class='bi bi-x text-danger mr-2'></i><code>${x}</code>`).join('<br>')));
    }, function onError(err) {
      const $out = $('#output_area');
      $out.empty().append(
        $('<div class="alert alert-danger" role="alert">')
          .text('Error: ' + (err?.message || 'Request failed'))
      );
    });
  }
});
</script>
