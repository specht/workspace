<style>
    h2 {
        margin: 1em 0;
    }
</style>
<div class='container'>
    <div class='row'>
        <div class='col-md-12'>
            <div class="row">
                <div class="col-sm-6"><h2>Abmelden</h2></div>
                <div class="col-sm-6 btn-module"><a style='margin-top: 4px; #{!@session_user.nil? ? '' : 'display: none;'}' class="btn btn-secondary" href="/logout"><i class='fa fa-sign-out'></i>&nbsp;Abmelden</a></div>
            </div>
            <p>
                Drücke den Button, um dich in diesem Browser abzumelden. Du kannst dich später wieder mit deiner E-Mail-Adresse anmelden, deine Dateien und Einstellungen bleiben erhalten.
            </p>
            <hr>
            <div class="row">
                <div class="col-sm-6"><h2>Workspace</h2></div>
                <div class="col-sm-6 btn-module">#{print_module_button(:workspace)}</div>
            </div>
            <p>
                Der Workspace ist deine persönliche Visual Studio Code-Arbeitsumgebung. Hier kannst du Dateien erstellen, bearbeiten und löschen. Du kannst auch neue Dateien und Ordner erstellen und Dateien hochladen.
            </p>
            <div class="row">
                <div class="col-sm-6"><h4>Workspace teilen</h4></div>
                <div class="col-sm-6 btn-module-4" style="margin-top: 0;">
                    <button style='#{(@session_user || {})[:share_tag].nil? ? '' : 'display: none;'}' id='bu_share' class="btn btn-primary"><i class='fa fa-send'></i>&nbsp;&nbsp;Workspace teilen</button>
                    <button style='#{(@session_user || {})[:share_tag].nil? ? 'display: none;' : ''}' id='bu_stop_share' class="btn btn-primary"><i class='fa fa-trash'></i>&nbsp;&nbsp;Teilen beenden</button>
                </div>
            </div>
            <p>
                Wenn du jemandem deinen Workspace zeigen möchtest oder dir helfen lassen möchtest, kannst du deinen Workspace teilen. Du erhältst einen Link, den du weitergeben kannst. Jeder, der diesen Link hat, uneingeschränkten Zugriff auf deinen Workspace, auch ohne Anmeldung. Der Link ist solange gültig, bis du ihn deaktivierst.
            </p>
            <div id='div_share_link' style="max-width: 100%; overflow-x: auto; #{(@session_user || {})[:share_tag] ? '' : 'display: none;'}" class="mt-2 mb-4">
                <div style="display: table; margin-left: auto; margin-right: auto;">
                    <div class="input-group">
                        <span class="input-group-text">Freigabelink:</span>
                        <input type="text" id='ti_share_link' style='width: 42em; max-width: 100%;' class="form-control" readonly value="#{WEB_ROOT}/share/#{(@session_user || {})[:share_tag]}">
                        <button id='bu_copy_share_link' class='btn btn-secondary btn-clipboard' data-clipboard-action='copy' title='Eintrag in die Zwischenablage kopieren' data-clipboard-text='#{WEB_ROOT}/share/#{(@session_user || {})[:share_tag]}'><i class='fa fa-clipboard'></i></button>
                    </div>
                </div>
            </div>
            <h4>Workspace zurücksetzen</h4>
            <p>
                Hier kannst du deinen Workspace zurücksetzen. Alle Dateien, Einstellungen und installierte Erweiterungen werden gelöscht und dein Workspace wird auf den Ursprungszustand zurückgesetzt.
            </p>
            <div>
                <button id='bu_reset_workspace' class="btn btn-danger"><i class='fa fa-trash'></i>&nbsp;&nbsp;Workspace zurücksetzen</button>
            </div>
            <hr>
            <div class="row">
                <div class="col-sm-6"><h2>MySQL</h2></div>
                <div class="col-sm-6 btn-module">#{print_module_button(:phpmyadmin)}</div>
            </div>
            <p>
                Du hast eine MySQL-Datenbank, die du im Workspace verwenden kannst. Du kannst Tabellen erstellen, Daten einfügen, abfragen und löschen.
            </p>
            <p>
                Deine Zugangsdaten lauten:
            </p>
            <div class="row g-3 align-items-center mb-3">
                <div class="col-md-2">
                    <label for="ti_mysql_host" class="col-form-label">Host:</label>
                </div>
                <div class="col-md-4">
                    <input type="text" id="ti_mysql_host" class="form-control" readonly value="mysql">
                </div>
                <div class="col-md-2">
                    <label for="ti_mysql_user" class="col-form-label">Benutzername:</label>
                </div>
                <div class="col-md-4">
                    <input type="text" id="ti_mysql_user" class="form-control" readonly value="#{@session_user[:email]}">
                </div>
                <div class="col-md-2">
                    <label for="ti_mysql_db" class="col-form-label">Datenbank:</label>
                </div>
                <div class="col-md-4">
                    <input type="text" id="ti_mysql_db" class="form-control" readonly value="#{@session_user[:email]}">
                </div>
                <div class="col-md-2">
                    <label for="ti_mysql_password" class="col-form-label">Passwort:</label>
                </div>
                <div class="col-md-4">
                    <input type="text" id="ti_mysql_password" class="form-control" readonly value="#{Main.gen_password_for_email(@session_user[:email], MYSQL_PASSWORD_SALT)}">
                </div>
            </div>
            <div class="hint">
                Deine Zugangsdaten sind im Workspace in den Umgebungsvariablen <code>MYSQL_HOST</code>, <code>MYSQL_USER</code>, <code>MYSQL_PASSWORD</code> und <code>MYSQL_DB</code> hinterlegt, damit du keine Zugangsdaten im Quellcode deiner Programme speichern musst.
            </div>
            <h4>Datenbank zurücksetzen</h4>
            <p>
                Hier kannst du deine MySQL-Datenbank zurücksetzen. Alle Tabellen und Daten werden gelöscht und deine Datenbank wird auf den Ursprungszustand zurückgesetzt.
            </p>
            <div>
                <button id='bu_reset_mysql' class="btn btn-danger"><i class='fa fa-trash'></i>&nbsp;&nbsp;Datenbank zurücksetzen</button>
            </div>
            <hr>
            <div class="row">
                <div class="col-sm-6"><h2>TIC-80</h2></div>
                <div class="col-sm-6 btn-module">#{print_module_button(:tic80)}</div>
            </div>
            <p>
                Der TIC-80 ist ein Fantasy-Computer für Spiele, Demos und Prototypen. Du kannst Programme in der Programmiersprache Lua schreiben und ausführen, aber auch andere Sprachen sind möglich. Im Unterschied zum TIC-80 auf <a href='https://tic80.com/create' target='_blank'>https://tic80.com/create</a> kannst du hier die Pro-Version verwenden und deine Dateien werden automatisch gespeichert, so dass du sie nicht verlierst.

            </p>
            <!-- <h4>TIC-80 zurücksetzen</h4>
            <p>
                Hiermit kannst du deinen TIC-80 zurücksetzen. Alle Dateien werden gelöscht und dein TIC-80 wird auf den Ursprungszustand zurückgesetzt.
            </p>
            <div>
                <button id='bu_reset_tic80' class="btn btn-danger"><i class='fa fa-trash'></i>&nbsp;&nbsp;TIC-80 zurücksetzen</button>
            </div> -->
        </div>
    </div>
</div>

<script>
    window.addEventListener('load', function() {
        $('.bu-toggle-module').on('click', function(e) {
            let key = $(e.target).closest('button').data('module');
            api_call('/api/toggle_show_module', {module: key}, function(data) {
                if (data.success) {
                    window.location.reload();
                }
            });
        });
        $('#bu_reset_workspace').on('click', function() {
            showTemplateModal('Workspace zurücksetzen', `<div>Bist du sicher, dass du deinen Workspace zurücksetzen möchtest? Alle Dateien, Einstellungen und installierte Erweiterungen werden gelöscht.</div><div id='div_reset_workspace_please_wait' style='display: none; margin-top: 1em;'><i class='fa fa-cog fa-spin'></i>&nbsp;&nbsp;Moment, dein Workspace wird auf den Ursprungszustand zurückgesetzt…</div><div id='div_reset_workspace_success' style='display: none; margin-top: 1em;'><i class='text-success fa fa-check'></i>&nbsp;&nbsp;Dein Workspace wurde auf den Ursprungszustand zurückgesetzt.</div>`,
            "<i class='fa fa-trash'></i>&nbsp;&nbsp;Zurücksetzen", 'btn-danger', "<i class='fa fa-times'></i>&nbsp;&nbsp;Abbruch", 'btn-secondary', function() {
                $('#div_reset_workspace_please_wait').slideDown();
                api_call('/api/reset_server', {}, function(data) {
                    $('#div_reset_workspace_please_wait').hide();
                    $('#div_reset_workspace_success').show();
                    $('#__template_modal .modal-footer .btn').eq(0).hide();
                    $('#__template_modal .modal-footer .btn').eq(1).html(`<i class='fa fa-times'></i>&nbsp;&nbsp;Schließen`);
                });
                return false;
            });
        });
        $('#bu_reset_mysql').on('click', function() {
            showTemplateModal('MySQL-Datenbank zurücksetzen', `<div>Bist du sicher, dass du deine MySQL-Datenbank zurücksetzen möchtest? Alle Tabellen und Daten werden gelöscht.</div><div id='div_reset_mysql_please_wait' style='display: none; margin-top: 1em;'><i class='fa fa-cog fa-spin'></i>&nbsp;&nbsp;Moment, deine Datenbank wird auf den Ursprungszustand zurückgesetzt…</div><div id='div_reset_mysql_success' style='display: none; margin-top: 1em;'><i class='text-success fa fa-check'></i>&nbsp;&nbsp;Deine Datenbank wurde auf den Ursprungszustand zurückgesetzt.</div>`,
            "<i class='fa fa-trash'></i>&nbsp;&nbsp;Zurücksetzen", 'btn-danger', "<i class='fa fa-times'></i>&nbsp;&nbsp;Abbruch", 'btn-secondary', function() {
                $('#div_reset_mysql_please_wait').slideDown();
                api_call('/api/reset_mysql', {}, function(data) {
                    $('#div_reset_mysql_please_wait').hide();
                    $('#div_reset_mysql_success').show();
                    $('#__template_modal .modal-footer .btn').eq(0).hide();
                    $('#__template_modal .modal-footer .btn').eq(1).html(`<i class='fa fa-times'></i>&nbsp;&nbsp;Schließen`);
                });
                return false;
            });
        });
    });
</script>